/*jslint devel: true, bitwise: true, browser: true, white: true, nomen: true, plusplus: true, maxerr: 50, indent: 4 *//*global Float32Array, Uint8Array, Uint16Array, WebGLTexture, HTMLInputElement, HTMLSelectElement, HTMLElement, WebGLFramebuffer, HTMLCanvasElement, WebGLRenderingContext */(function(a,b){function n(a,b){var d,e;if(typeof a=="string")d=c.querySelector(a);else if(!a)return!1;return a.tagName&&(d=a),d?(e=d.tagName.toLowerCase(),b&&b.indexOf(e)<0?a:d):a}function o(a,b){var c,d,e;a.prototype&&b.prototype&&a.prototype!==b.prototype&&o(a.prototype,b.prototype);for(c in b)d=b.__lookupGetter__(c),e=b.__lookupSetter__(c),d||e?(d&&a.__defineGetter__(c,d),e&&a.__defineSetter__(c,e)):a[c]=b[c];return a}function p(a,b,c,d){function e(a,b,c){return c%=1,c<0&&(c+=1),c<1/6?a+(b-a)*c*6:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var f,g;return c<.5?g=c*(b+1):g=c+b-c*b,f=c*2-g,[e(f,g,a+1/3),e(f,g,a),e(f,g,a-1/3),d]}function q(b){function c(){h.length&&h.shift()()}if(typeof b!="function")throw"setTimeoutZero argument is not a function";h.push(b);if(a.location.protocol==="file:"){setTimeout(c,0);return}a.postMessage("seriously-timeout-message",a.location)}function r(b){var e,f,g,h;e=n(b,["img","canvas","video"]);if(!e)return!1;f=c.createElement("canvas");if(!f)return d.log("Browser does not support canvas or Seriously.js"),!1;if(a.WebGLRenderingContext)try{g=f.getContext("experimental-webgl")}catch(i){d.log("Unable to access WebGL. Trying 2D canvas.")}if(g){h=g.createTexture(),g.bindTexture(g.TEXTURE_2D,h);try{g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,e)}catch(j){return j.name==="SECURITY_ERR"?d.log("Unable to access cross-domain image"):d.log("Error: "+j.message),g.deleteTexture(h),!1}g.deleteTexture(h)}else{g=f.getContext("2d");try{g.drawImage(e,0,0),g.getImageData(0,0,1,1)}catch(k){return k.name==="SECURITY_ERR"?d.log("Unable to access cross-domain image"):d.log("Error: "+k.message),!1}}return!0}function s(a,b,c,d){var e,f,g,h;d=!1,d?this.type=a.FLOAT:this.type=a.UNSIGNED_BYTE,e=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,e),this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);try{this.type===a.FLOAT?(g=new Float32Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.FLOAT,g)):(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null),this.type=a.UNSIGNED_BYTE)}catch(i){this.type=a.UNSIGNED_BYTE,g=new Uint8Array(b*c*4),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,g)}f=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,f),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b,c),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0),a.bindTexture(a.TEXTURE_2D,null),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null);if(!a.isFramebuffer(e))throw"Invalid framebuffer";h=a.checkFramebufferStatus(a.FRAMEBUFFER);if(h===a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";if(h===a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";if(h===a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS)throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";if(h===a.FRAMEBUFFER_UNSUPPORTED)throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";if(h!==a.FRAMEBUFFER_COMPLETE)throw"Incomplete framebuffer: "+h;this.gl=a,this.frameBuffer=e,this.renderBuffer=f,this.width=b,this.height=c}function t(a,b,c){function r(b,c){var e,f;c?e=a.createShader(a.FRAGMENT_SHADER):e=a.createShader(a.VERTEX_SHADER),a.shaderSource(e,b),a.compileShader(e);if(!a.getShaderParameter(e,a.COMPILE_STATUS)){b=b.split(/[\n\r]/);for(f=0;f<b.length;f++)b[f]=f+1+":	"+b[f];throw d.log(b.join("\n")),"Shader error: "+a.getShaderInfoLog(e)}return e}function s(b,c){if(b.type===a.SAMPLER_2D)return function(d){b.glTexture=a["TEXTURE"+d],a.uniform1i(c,d)};if(b.type===a.BOOL||b.type===a.INT)return b.size>1?function(b){a.uniform1iv(c,b)}:function(b){a.uniform1i(c,b)};if(b.type===a.FLOAT)return b.size>1?function(b){a.uniform1fv(c,b)}:function(b){a.uniform1f(c,b)};if(b.type===a.FLOAT_VEC2)return function(b){Array.isArray(b)?a.uniform2f(c,b[0],b[1]):a.uniform2f(c,b.x,b.y)};if(b.type===a.FLOAT_VEC3)return function(b){Array.isArray(b)?a.uniform3f(c,b[0],b[1],b[2]):a.uniform3f(c,b.x,b.y,b.z)};if(b.type===a.FLOAT_VEC4)return function(b){Array.isArray(b)?a.uniform4f(c,b[0],b[1],b[2],b[3]):a.uniform4f(c,b.x,b.y,b.z,b.w)};if(b.type===a.FLOAT_MAT3)return function(b){a.uniformMatrix3fv(c,!1,b)};if(b.type===a.FLOAT_MAT4)return function(b){a.uniformMatrix4fv(c,!1,b)};throw"Unknown shader uniform type: "+b.type}function t(b){return function(){return a.getUniform(e,b)}}var e,f,g,h="",i,j,k,l,m,n,o,p,q;f=r(b),g=r(c,!0),e=a.createProgram(),a.attachShader(e,f),i=a.getShaderInfoLog(f),i&&(h+="Vertex shader error: "+i+"\n"),a.attachShader(e,g),i=a.getShaderInfoLog(g),i&&(h+="Fragment shader error: "+i+"\n"),a.linkProgram(e);if(!a.getProgramParameter(e,a.LINK_STATUS))throw h+=a.getProgramInfoLog(e),a.deleteProgram(e),a.deleteShader(f),a.deleteShader(g),"Could not initialise shader: "+h;a.useProgram(e),j=a.getProgramParameter(e,a.ACTIVE_UNIFORMS),this.uniforms=[];for(l=0;l<j;++l)m=a.getActiveUniform(e,l),n=m.name,o=a.getUniformLocation(e,n),o.name=n,p=s(m,o),m.set=p,this["set_"+n]=p,q=t(o),m.get=q,this["get_"+n]=q,m.loc=this["location_"+n]=o,this.uniforms.push(m);k=a.getProgramParameter(e,a.ACTIVE_ATTRIBUTES),this.attributes=[];for(l=0;l<k;++l)m=a.getActiveAttrib(e,l),n=m.name,o=a.getAttribLocation(e,n),this["location_"+n]=o,this.attributes.push(n);this.gl=a,this.program=e,this.destroy=function(){var b;a&&(a.deleteProgram(e),a.deleteShader(f),a.deleteShader(g));for(b in this)this.hasOwnProperty(b)&&delete this[b];e=null,f=null,g=null}}function u(e){function O(a){var b,c,d;return a?(b=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,b),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1]),a.STATIC_DRAW),b.size=3,c=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),a.STATIC_DRAW),d=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,d),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),a.STATIC_DRAW),d.size=2,{vertex:b,index:c,texCoord:d,length:6,mode:a.TRIANGLES}):!1}function P(a){var b,c;z=a,y=a.canvas,A=O(z),B=new t(z,C,D);for(b=0;b<v.length;b++)c=v[b],c.gl=z,c.initialized&&c.buildShader();for(b=0;b<p.length;b++)c=p[b],c.initialize();for(b=0;b<r.length;b++)c=r[b],c.model||(c.model=A)}function Q(){var a,c,d;if(p&&p.length){for(a=0;a<p.length;a++){c=p[a],d=c.source;if(c.lastRenderTime===b||c.dirty||d.currentTime!==b&&c.lastRenderTime!==d.currentTime)c.dirty=!1,c.setDirty()}m(Q)}}function R(a,c,d,e,f,g){var h=0,i,j,k,l,m,n=f&&f.gl||z,o=g||{};if(!n)return;f?(l=o.width||f.width||n.canvas.width,m=o.height||f.height||n.canvas.height):(l=o.width||n.canvas.width,m=o.height||n.canvas.height),a.useProgram(),n.viewport(0,0,l,m),n.bindFramebuffer(n.FRAMEBUFFER,e),n.enableVertexAttribArray(a.location_position),n.enableVertexAttribArray(a.location_texCoord),c.texCoord&&(n.bindBuffer(n.ARRAY_BUFFER,c.texCoord),n.vertexAttribPointer(a.location_texCoord,c.texCoord.size,n.FLOAT,!1,0,0)),n.bindBuffer(n.ARRAY_BUFFER,c.vertex),n.vertexAttribPointer(a.location_position,c.vertex.size,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,c.index),o.depth?z.enable(z.DEPTH_TEST):z.disable(z.DEPTH_TEST),o.blend===b||o.blend?(z.enable(z.BLEND),z.blendFuncSeparate(z.SRC_ALPHA,z.ONE_MINUS_SRC_ALPHA,z.SRC_ALPHA,z.DST_ALPHA),z.blendEquation(z.FUNC_ADD)):z.disable(z.BLEND);for(i in d)d.hasOwnProperty(i)&&(j=d[i],k="set_"+i,a[k]&&(j instanceof WebGLTexture?(n.activeTexture(n.TEXTURE0+h),n.bindTexture(n.TEXTURE_2D,j),a[k](h),h++):j instanceof F||j instanceof G?j.texture&&(n.activeTexture(n.TEXTURE0+h),n.bindTexture(n.TEXTURE_2D,j.texture),a[k](h),h++):j!==b&&j!==null&&a["set_"+i](j)));if(o.clear===b||o.clear)n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);n.drawElements(c.mode,c.length,n.UNSIGNED_SHORT,0),z.enable(z.DEPTH_TEST)}function S(a,b){var c,d;if(a instanceof F||a instanceof G)c=a;else if(a instanceof I||a instanceof J){c=k[a.id];if(!c)throw"Cannot connect a foreign node"}else{typeof a=="string"&&isNaN(a)&&(a=n(a,["canvas","img","video"]));for(d=0;d<p.length;d++)if(p[d].source===a)return p[d];c=new F(a,b)}return c}function T(){function a(){var a;for(a=0;a<x.length;a++)x[a].call(f);M=!1}M||(q(a),M=!0)}if(!(a!==this&&this instanceof u))return new u(e);var f=this,h=[],k={},l=0,p=[],r=[],v=[],w={},x=[],y,z,A,B,C,D,E,F,G,H,I,J,K,L=!1,M=!1,N=!1;E=function(a){this.transform=new Float32Array(j),a&&(this.desiredWidth=parseInt(a.width,10),this.desiredHeight=parseInt(a.height,10)),this.gl=z,this.uniforms={transform:this.transform},this.dirty=!0,this.isDestroyed=!1,this.seriously=f,this.id=l,h.push(this),k[l]=this,l++},E.prototype.setDirty=function(){var a;if(!this.dirty){this.dirty=!0;if(this.targets)for(a=0;a<this.targets.length;a++)this.targets[a].setDirty()}},E.prototype.initFrameBuffer=function(a){z&&(this.width||(this.width=this.desiredWidth||y.width),this.height||(this.height=this.desiredHeight||y.height),this.frameBuffer=new s(z,this.width,this.height,a))},E.prototype.readPixels=function(a,c,d,e,f){if(!z)throw"Cannot read pixels until a canvas is connected";this.frameBuffer||this.initFrameBuffer(),this.render(),this instanceof F&&(this.uniforms.source=this.texture,R(B,A,this.uniforms,this.frameBuffer.frameBuffer,this));if(f===b)f=new Uint8Array(d*e*4);else if(!f instanceof Uint8Array)throw"Incompatible array type";return z.bindFramebuffer(z.FRAMEBUFFER,this.frameBuffer.frameBuffer),z.readPixels(a,c,d,e,z.RGBA,z.UNSIGNED_BYTE,f),f},E.prototype.reset=function(){this.transform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.setDirty()},E.prototype.translate=function(a,b){var c=this.transform;c[12]=c[0]*a+c[4]*b+c[12],c[13]=c[1]*a+c[5]*b+c[13],c[14]=c[2]*a+c[6]*b+c[14],c[15]=c[3]*a+c[7]*b+c[15],this.setDirty()},E.prototype.scale=function(a,b){var c=this.transform;c[0]*=a,c[1]*=a,c[2]*=a,c[3]*=a,c[4]*=b,c[5]*=b,c[6]*=b,c[7]*=b,this.setDirty()},E.prototype.rotateY=function(a){var b=this.transform,c=Math.sin(a),d=Math.cos(a),e=b[0],f=b[1],g=b[2],h=b[3],i=b[8],j=b[9],k=b[10],l=b[11];b[0]=e*d+i*-c,b[1]=f*d+j*-c,b[2]=g*d+k*-c,b[3]=h*d+l*-c,b[8]=e*c+i*d,b[9]=f*c+j*d,b[10]=g*c+k*d,b[11]=h*c+l*d,this.setDirty()},E.prototype.rotateZ=function(a){var b=this.transform,c=Math.sin(a),d=Math.cos(a),e=b[0],f=b[1],g=b[2],h=b[3],i=b[4],j=b[5],k=b[6],l=b[7];b[0]=e*d+i*c,b[1]=f*d+j*c,b[2]=g*d+k*c,b[3]=h*d+l*c,b[4]=e*-c+i*d,b[5]=f*-c+j*d,b[6]=g*-c+k*d,b[7]=h*-c+l*d,this.setDirty()},E.prototype.destroy=function(){var a;delete this.gl,delete this.seriously;for(a in this.uniforms)delete this.uniforms[a];this.targets&&delete this.targets,this.frameBuffer&&this.frameBuffer.destroy&&(this.frameBuffer.destroy(),delete this.frameBuffer),a=h.indexOf(this),a>=0&&h.splice(a,1),delete k[this.id],this.isDestroyed=!0},I=function(a){function e(a){var b,c,d="#";for(b=0;b<4;b++)c=Math.min(255,Math.round(a[b]*255||0)),d+=c.toString(16);return d}function f(a,b){var c,f,g,h;return g=d.effect.inputs[a],c=d.inputElements[a],typeof b=="string"&&isNaN(b)&&(g.type==="enum"?(g.options&&g.options.filter&&(h=(""+b).toLowerCase(),f=g.options.filter(function(a){return typeof a=="string"&&a.toLowerCase()===h||a.length&&typeof a[0]=="string"&&a[0].toLowerCase()===h}),f=f.length),f||(b=n(b,["select"]))):g.type==="number"?b=n(b,["input","select"]):g.type==="image"&&(b=n(b,["canvas","img","video"]))),b instanceof HTMLInputElement||b instanceof HTMLSelectElement?(f=b.value,c&&c.element!==b&&(c.element.removeEventListener("change",c.listener,!0),delete d.inputElements[a],c=null),c||(c={element:b,listener:function(a,c){return function(){var f,h;b.type==="checkbox"?f=b.checked:f=c.value,h=d.setInput(a,f),g.type==="color"&&(h=e(h)),h!==f&&(c.value=h)}}(a,b)},b.type==="checkbox"&&(f=b.checked),d.inputElements[a]=c,b.addEventListener("change",c.listener,!0))):(c&&(c.element.removeEventListener("change",c.listener,!0),delete d.inputElements[a]),f=b),d.setInput(a,f),d.inputs[a]}var c,d=a;for(c in d.effect.inputs){if(this[c]!==b)throw"Cannot overwrite Seriously."+c;d.effect.inputs[c].type==="image"?(this.__defineSetter__(c,function(a){return function(b){var c=f(a,b);return c&&c.pub}}(c)),this.__defineGetter__(c,function(a){return function(){var b=d.inputs[a];return b&&b.pub}}(c))):(this.__defineSetter__(c,function(a){return function(b){return f(a,b)}}(c)),this.__defineGetter__(c,function(a){return function(){return d.inputs[a]}}(c)))}this.__defineGetter__("inputs",function(){return{source:{type:"image"}}}),this.__defineSetter__("inputs",function(){return}),this.__defineGetter__("original",function(){return d.source}),this.__defineSetter__("original",function(){}),this.__defineSetter__("width",function(a){d.setSize(a)}),this.__defineSetter__("height",function(a){d.setSize(b,a)}),this.__defineGetter__("id",function(){return d.id}),this.__defineSetter__("id",function(){}),this.render=function(a){return d.render(a),this},this.alias=function(a,b){return d.alias(a,b),this},this.reset=function(){d.reset()},this.translate=function(a,b,c){d.translate(a,b,c)},this.scale=function(a,b){d.scale(a,b)},this.rotateY=function(a){d.rotateZ(a)},this.rotateZ=function(a){d.rotateZ(a)},this.destroy=function(){var a,b=function(){};d.destroy();for(a in this)this.hasOwnProperty(a)&&a!=="isDestroyed"&&(this.__lookupGetter__(a)||typeof this[a]!="function"?delete this[a]:this[a]=b)},this.isDestroyed=function(){return d.isDestroyed}},G=function(a,b){E.call(this,b),this.effect=g[a],this.sources={},this.targets=[],this.inputElements={},this.dirty=!0,this.shaderDirty=!0,this.hook=a,this.options=b,this.inputs={};var c,d;for(c in this.effect.inputs)d=this.effect.inputs[c],this.inputs[c]=d.defaultValue,d.uniform&&(this.uniforms[d.uniform]=d.defaultValue);z&&this.buildShader(),this.pub=new I(this),v.push(this),i[a].push(this)},o(G,E),G.prototype.initialize=function(){if(!this.initialized){var a=this;this.model=A,typeof this.effect.initialize=="function"?this.effect.initialize.call(this,function(){a.initFrameBuffer(!0)},z):this.initFrameBuffer(!0),this.frameBuffer&&(this.texture=this.frameBuffer.texture),this.initialized=!0}},G.prototype.setSize=function(a,c){var d,e=0,f=0,g=!1;a!==b&&(a<=0?this.desiredWidth=null:(this.desiredWidth!==a&&(g=!0),this.desiredWidth=a)),c!==b&&(c<=0?this.desiredHeight=null:(this.desiredHeight!==c&&(g=!0),this.desiredHeight=c));if(!this.desiredWidth||!this.desiredHeight){for(d=0;d<this.targets.length;d++)e=Math.max(e,this.targets[d].width),f=Math.max(f,this.targets[d].height);this.width=this.desiredWidth||e,this.height=this.desiredHeight||f,this.setDirty();for(d in this.sources)this.sources[d].setSize&&this.sources[d].setSize()}else this.width=this.desiredWidth,this.height=this.desiredHeight,g&&this.setDirty()},G.prototype.setTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a),this.setSize()},G.prototype.removeTarget=function(a){var b=this.targets&&this.targets.indexOf(a);b>=0&&this.targets.splice(b,1),this.setSize()},G.prototype.removeSource=function(a){var b,c=a&&a.pub;for(b in this.inputs)if(this.inputs[b]===a||this.inputs[b]===c)this.inputs[b]=null;for(b in this.sources)if(this.sources[b]===a||this.sources[b]===c)this.sources[b]=null},G.prototype.buildShader=function(){var a,b=this.effect;this.shaderDirty&&(b.shader?(a=b.shader.call(this,this.inputs,{vertex:C,fragment:D},u.util),a instanceof t?this.shader=a:a&&a.vertex&&a.fragment?this.shader=new t(z,a.vertex,a.fragment):this.shader=B):this.shader=B,this.shaderDirty=!1)},G.prototype.render=function(a){var b,c,d=this.effect,e=this,f=this.dirty||this.reusedFrameBuffer;this.initialized||this.initialize(),this.shaderDirty&&this.buildShader();if(f){for(b in this.sources)(!d.requires||d.requires.call(this,b,this.inputs))&&this.sources[b].render();this.reusedFrameBuffer||this.frameBuffer&&(c=this.frameBuffer.frameBuffer),typeof d.draw=="function"?d.draw.call(this,this.shader,this.model,this.uniforms,c,function(a,b,c,d,f,g){R(a,b,c,d,f||e,g)}):c&&R(this.shader,this.model,this.uniforms,c,this),this.dirty=!1}return a&&typeof a=="function"&&a(),this},G.prototype.setInput=function(a,b){function e(a,b){var c,d,f;if(a instanceof G){f=a.sources;for(c in f){d=f[c];if(d===b||e(d,b))return!0}return!1}return!1}var c,d;if(this.effect.inputs.hasOwnProperty(a)){c=this.effect.inputs[a];if(c.type==="image"){if(b){b=S(b);if(b!==this.sources[a]){this.sources[a]&&this.sources[a].removeTarget(this);if(e(b,this))throw"Attempt to make cyclical connection.";this.sources[a]=b,b.setTarget(this)}}else b=!1;d=this.sources[a]}else b=c.validate.call(this,b,c,a),d=b;return this.inputs[a]=b,c.uniform&&(this.uniforms[c.uniform]=d),c.shaderDirty&&(this.shaderDirty=!0),this.setDirty(),b}},G.prototype.alias=function(a,b){var c=this,d=["source","target","effect","effects","benchmark","incompatible","util","ShaderProgram","inputValidators","save","load","plugin","removePlugin","alias","removeAlias","stop","go","destroy","isDestroyed"];if(d.indexOf(b)>=0)throw b+" is a reserved name and cannot be used as an alias.";return this.effect.inputs.hasOwnProperty(a)&&(b||(b=a),f.removeAlias(b),w[b]={node:this,input:a},f.__defineSetter__(b,function(b){return c.setInput(a,b)}),f.__defineGetter__(b,function(){return c.inputs[a]})),this},G.prototype.destroy=function(){var a,b,c=this.hook;this.effect.destroy&&typeof this.effect.destroy=="function"&&this.effect.destroy.call(this),delete this.effect,this.shader&&this.shader.destroy&&this.shader!==B&&this.shader.destroy(),delete this.shader;for(a in this.inputElements)b=this.inputElements[a],b.element.removeEventListener("change",b.listener,!0);for(a in this.sources)b=this.sources[a],b&&b.removeTarget&&b.removeTarget(this),delete this.sources[a];for(a=0;a<this.targets.length;a++)b=this.targets[a],b&&b.removeSource&&b.removeSource(this),delete this.targets[a];for(a in this)a!=="id"&&this.hasOwnProperty(a)&&delete this[a];for(a in w)b=w[a],b.node===this&&f.removeAlias(a);a=v.indexOf(this),a>=0&&v.splice(a,1),a=i[c].indexOf(this),a>=0&&i[c].splice(a,1),E.prototype.destroy.call(this)},J=function(a){var b=a;this.__defineGetter__("original",function(){return b.source}),this.__defineSetter__("original",function(){}),this.__defineGetter__("id",function(){return b.id}),this.__defineSetter__("id",function(){}),this.render=function(a){b.render(a)},this.update=function(){b.setDirty()},this.readPixels=function(a,c,d,e,f){return b.readPixels(a,c,d,e,f)},this.destroy=function(){var a,c=function(){};b.destroy();for(a in this)this.hasOwnProperty(a)&&a!=="isDestroyed"&&(this.__lookupGetter__(a)||typeof this[a]!="function"?delete this[a]:this[a]=c)},this.isDestroyed=function(){return b.isDestroyed}},F=function(a,c){var d=c||{},e=d.flip===b?!0:d.flip,f,g,h=!1,i=this,j=!1;E.call(this,c),f=this.desiredWidth,g=this.desiredHeight,typeof a=="string"&&isNaN(a)&&(a=n(a,["canvas","img","video"]));if(a instanceof HTMLElement){if(a.tagName==="CANVAS")this.desiredWidth=f=a.width,this.desiredHeight=g=a.height,this.render=this.renderImageCanvas;else if(a.tagName==="IMG")f=a.naturalWidth,g=a.naturalHeight,a.complete||(h=!0,a.addEventListener("load",function(){i.desiredWidth=a.naturalWidth,i.desiredHeight=a.naturalHeight,i.currentTime=a.src,i.width=i.desiredWidth,i.height=i.desiredHeight,i.initialize()},!0)),this.render=this.renderImageCanvas;else{if(a.tagName!=="VIDEO")throw"Not a valid HTML element: "+a.tagName+" (must be img, video or canvas)";i.desiredWidth=f=a.videoWidth,i.desiredHeight=g=a.videoHeight,a.readyState||(h=!0,a.addEventListener("loadedmetadata",function(){i.desiredWidth=a.videoWidth,i.desiredHeight=a.videoHeight,i.width=i.desiredWidth,i.height=i.desiredHeight,i.initialize()},!0)),this.render=this.renderVideo}j=!0}else if(a instanceof Object&&a.data&&a.width&&a.height&&a.width*a.height*4===a.data.length)this.desiredWidth=f=a.width,this.desiredHeight=g=a.height,j=!0,this.render=this.renderImageCanvas;else if(Array.isArray(a)){if(!f||!g)throw"Height and width must be provided with an Array";if(f*g*4!==a.length)throw"Array length must be height x width x 4.";j=!0,d.flip===b&&(e=!1),a=new Uint8Array(a),this.render=this.renderTypedArray}else if(a instanceof Uint8Array){if(!f||!g)throw"Height and width must be provided with a Uint8Array";if(f*g*4!==a.length)throw"Typed array length must be height x width x 4.";j=!0,d.flip===b&&(e=!1),this.render=this.renderTypedArray}else if(a instanceof WebGLTexture){if(z&&!z.isTexture(a))throw"Not a valid WebGL texture.";isNaN(f)?isNaN(g)||(f=g):isNaN(g)&&(g=f),d.flip===b&&(e=!1),j=!0,this.texture=a,this.initialized=!0,this.render=function(a){}}if(!j)throw"Unknown source type";h||this.initialize(),this.source=a,this.flip=e,this.width=f,this.height=g,this.targets=[],this.pub=new J(this),p.push(this),p.length===1&&Q()},o(F,E),F.prototype.initialize=function(){if(!z||this.texture)return;var a=z.createTexture();z.bindTexture(z.TEXTURE_2D,a),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.bindTexture(z.TEXTURE_2D,null),this.texture=a,this.initialized=!0,this.allowRefresh=!0,this.setDirty()},F.prototype.setTarget=function(a){var b;for(b=0;b<this.targets.length;b++)if(this.targets[b]===a)return;this.targets.push(a)},F.prototype.removeTarget=function(a){var b=this.targets&&this.targets.indexOf(a);b>=0&&this.targets.splice(b,1)},F.prototype.renderVideo=function(a){var b=this.source;if(!z||!b||!b.videoHeight||!b.videoWidth||b.readyState<2)return;this.initialized||this.initialize();if(!this.allowRefresh)return;if(this.dirty||this.lastRenderFrame!==b.mozPresentedFrames||this.lastRenderTime!==b.currentTime){z.bindTexture(z.TEXTURE_2D,this.texture),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,this.flip);try{z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,b)}catch(c){c.name==="SECURITY_ERR"&&(this.allowRefresh=!1,d.log("Unable to access cross-domain image"))}this.lastRenderTime=b.currentTime,this.lastRenderFrame=b.mozPresentedFrames,this.dirty=!1}a&&typeof a=="function"&&a()},F.prototype.renderImageCanvas=function(a){var b=this.source;if(!z||!b||!b.height||!b.width)return;this.initialized||this.initialize();if(!this.allowRefresh)return;if(this.dirty){z.bindTexture(z.TEXTURE_2D,this.texture),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,this.flip);try{z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,b)}catch(c){c.name==="SECURITY_ERR"&&(this.allowRefresh=!1,d.log("Unable to access cross-domain image"))}this.lastRenderTime=Date.now()/1e3,this.dirty=!1}a&&typeof a=="function"&&a()},F.prototype.renderTypedArray=function(a){var b=this.source;if(!z||!b||!b.length)return;this.initialized||this.initialize();if(!this.allowRefresh)return;this.dirty&&(z.bindTexture(z.TEXTURE_2D,this.texture),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,this.flip),z.texImage2D(z.TEXTURE_2D,0,z.RGBA,this.width,this.height,0,z.RGBA,z.UNSIGNED_BYTE,b),this.lastRenderTime=Date.now()/1e3,this.dirty=!1),a&&typeof a=="function"&&a()},F.prototype.destroy=function(){var a,b;this.gl&&this.texture&&this.gl.deleteTexture(this.texture);for(a=0;a<this.targets.length;a++)b=this.targets[a],b&&b.removeSource&&b.removeSource(this),delete this.targets[a];a=p.indexOf(this),a>=0&&p.splice(a,1);for(a in this)a!=="id"&&this.hasOwnProperty(a)&&delete this[a];E.prototype.destroy.call(this)},K=function(a){var c=a;this.__defineGetter__("inputs",function(){return{source:{type:"image"}}}),this.__defineSetter__("inputs",function(){return}),this.__defineGetter__("source",function(){if(c.source)return c.source.pub}),this.__defineSetter__("source",function(a){return c.setSource(a),this}),this.__defineGetter__("original",function(){return c.target}),this.__defineSetter__("original",function(){}),this.__defineSetter__("width",function(a){if(!isNaN(a)&&a>0&&c.width!==a){c.width=c.desiredWidth=a,c.target.width=a,c.setDirty();return}}),this.__defineSetter__("height",function(a){if(!isNaN(a)&&a>0&&c.height!==a){c.height=c.desiredHeight=a,c.target.height=a,c.setDirty();return}}),this.__defineGetter__("id",function(){return c.id}),this.__defineSetter__("id",function(){}),this.render=function(a){c.render(a)},this.go=function(a){c.go(a)},this.stop=function(){c.stop()},this.getTexture=function(){return c.frameBuffer.texture},this.destroy=function(){var a,b=function(){};c.destroy();for(a in this)this.hasOwnProperty(a)&&a!=="isDestroyed"&&(this.__lookupGetter__(a)||typeof this[a]!="function"?delete this[a]:this[a]=b)},this.isDestroyed=function(){return c.isDestroyed}},H=function(d,e){var f=e||{},g=f.flip===b?!0:f.flip,h=parseInt(f.width,10),i=parseInt(f.height,10),j=!1,k,l,m,n,o;E.call(this,e),this.renderToTexture=f.renderToTexture;if(typeof d=="string"){m=c.querySelectorAll(d);for(k=0;k<m.length;k++){l=m[k];if(l.tagName==="CANVAS")break}if(k>=m.length)throw"not a valid HTML element (must be image, video or canvas)";d=l}else if(d instanceof WebGLFramebuffer){o=d;if(f instanceof HTMLCanvasElement)d=f;else if(f instanceof WebGLRenderingContext)d=f.canvas;else if(f.canvas instanceof HTMLCanvasElement)d=f.canvas;else{if(!(f.context instanceof WebGLRenderingContext))throw"Must provide a canvas with WebGLFramebuffer target";d=f.context.canvas}}if(d instanceof HTMLElement&&d.tagName==="CANVAS"){h=d.width,i=d.height;try{a.WebGLDebugUtils?n=a.WebGLDebugUtils.makeDebugContext(d.getContext("experimental-webgl",{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!0})):n=d.getContext("experimental-webgl",{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!0})}catch(p){}if(!n)try{n=d.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!0})}catch(q){}n?!z||z===n?(z||P(n),this.render=this.renderWebGL,f.renderToTexture?this.frameBuffer=new s(z,h,i,!1):this.frameBuffer={frameBuffer:o||null}):n!==z&&(this.gl=n,o?this.frameBuffer={frameBuffer:o}:this.frameBuffer=new s(this.gl,h,i,!1),this.shader=new t(this.gl,C,D),this.model=O.call(this,this.gl),this.texture=this.gl.createTexture(),this.gl.bindTexture(z.TEXTURE_2D,this.texture),this.gl.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),this.gl.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),this.gl.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),this.gl.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),this.render=this.renderSecondaryWebGL):(n=d.getContext("2d"),this.render=this.render2D,this.use2D=!0),j=!0}if(!j)throw"Unknown target type";this.target=d,this.flip=g,this.width=h,this.height=i,this.callbacks=[],f.auto!==b?this.auto=f.auto:this.auto=L,this.frames=0,this.pub=new K(this),r.push(this)},o(H,E),H.prototype.setSource=function(a){var b;if(a instanceof F||a instanceof G)b=a;else if(a instanceof I||a instanceof J){b=k[a.id];if(!b)throw"Cannot connect a foreign node"}else b=S(a);b!==this.source&&(this.source&&this.source.removeTarget(this),this.source=b,b.setTarget(this),this.setDirty())},H.prototype.setDirty=function(){function b(){var b;for(b=0;b<a.callbacks.length;b++)a.callbacks[b]()}function c(){a.render(b)}var a;this.dirty=!0,this.auto&&(a=this,q(c))},H.prototype.go=function(a){a&&(typeof a=="function"?this.callbacks.push(a):a.callback&&typeof a.callback=="function"&&this.callbacks.push(a.callback)),this.auto=!0,this.setDirty()},H.prototype.stop=function(){this.auto=!1,this.callbacks.splice(0)},H.prototype.renderWebGL=function(a){var b;if(this.dirty){if(!this.source)return;this.source.render(),this.uniforms.source=this.source.texture,R(B,A,this.uniforms,this.frameBuffer.frameBuffer,this),this.dirty=!1,T()}a&&typeof a=="function"&&a()},H.prototype.renderSecondaryWebGL=function(a){if(this.dirty&&this.source){this.source.render();var b=this.source.width,c=this.source.height;if(!this.pixels||this.pixels.length!==b*c*4)this.pixels=new Uint8Array(b*c*4);this.source.readPixels(0,0,this.source.width,this.source.height,this.pixels),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,b,c,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pixels),this.uniforms.source=this.texture,R(this.shader,this.model,this.uniforms,null,this),this.dirty=!1,T()}a&&typeof a=="function"&&a()},H.prototype.render2D=function(a){T(),a&&typeof a=="function"&&a()},H.prototype.removeSource=function(a){if(this.source===a||this.source===a.pub)this.source=null},H.prototype.destroy=function(){var a;this.source&&this.source.removeTarget&&this.source.removeTarget(this),delete this.source,delete this.target,delete this.pub,delete this.uniforms,delete this.pixels,delete this.auto,this.callbacks.splice(0),a=r.indexOf(this),a>=0&&r.splice(a,1),E.prototype.destroy.call(this)},e instanceof HTMLCanvasElement?e={canvas:e}:e=e||{},!e.canvas,this.effect=function(a,b){if(!g[a])throw"Unknown effect: "+a;var c=new G(a,b);return c.pub},this.source=function(a,b){var c=S(a,b);return c.pub},this.target=function(a,b){var c,d;for(d=0;d<r.length;d++)if(r[d]===a||r[d].target===a)if(!!(b&&b.renderToTexture)==!!r[d].renderToTexture)return r[d].pub;return c=new H(a,b),c.pub},this.removeAlias=function(a){w[a]&&(delete this[a],delete w[a])},this.go=function(a){var b;a&&(typeof a=="function"?(x.push(a),a={}):a.callback&&typeof a.callback=="function"&&(x.push(a.callback),a=o({},a),delete a.callback)),L=!0;for(b=0;b<r.length;b++)r[b].go(a)},this.stop=function(a){var b;x.splice(0);for(b=0;b<r.length;b++)r[b].stop(a)},this.render=function(a){var b;for(b=0;b<r.length;b++)r[b].render(a)},this.destroy=function(){var a,b,c=function(){};while(h.length)b=h.shift(),b.destroy();B&&(B.destroy(),B=null),z&&(z.deleteBuffer(A.vertex),z.deleteBuffer(A.texCoord),z.deleteBuffer(A.index)),A&&(delete A.vertex,delete A.texCoord,delete A.index);for(a in this)this.hasOwnProperty(a)&&a!=="isDestroyed"&&(this.__lookupGetter__(a)||typeof this[a]!="function"?delete this[a]:this[a]=c);D=null,C=null,A=null,z=null,f=null,p=[],r=null,v=null,h=null,x.splice(0),N=!0},this.isDestroyed=function(){return N},this.incompatible=function(a){var b,c,d=!1;d=u.incompatible(a);if(d)return d;if(!a)for(b in i)if(i[b].length){c=g[b];if(c&&typeof c.compatible=="function"&&!c.compatible.call(this))return"plugin-"+b}return!1},C="#ifdef GL_ES\nprecision mediump float;\n#endif \n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nuniform mat4 transform;\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nvoid main(void) {\n	gl_Position = transform * vec4(position, 1.0);\n	vTexCoord = vec2(texCoord.s, texCoord.t);\n}\n",D="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\n\nvoid main(void) {\n	gl_FragColor = texture2D(source, vTexCoord);\n}\n"}"use strict";var c=a.document,d=a.console,e,f,g={},h=[],i={},j,k={transparent:[0,0,0,0],aliceblue:[240/255,248/255,1,1],antiquewhite:[250/255,235/255,215/255,1],aqua:[0,1,1,1],aquamarine:[127/255,1,212/255,1],azure:[240/255,1,1,1],beige:[245/255,245/255,220/255,1],bisque:[1,228/255,196/255,1],black:[0,0,0,1],blanchedalmond:[1,235/255,205/255,1],blue:[0,0,1,1],blueviolet:[138/255,43/255,226/255,1],brown:[165/255,42/255,42/255,1],burlywood:[222/255,184/255,135/255,1],cadetblue:[95/255,158/255,160/255,1],chartreuse:[127/255,1,0,1],chocolate:[210/255,105/255,30/255,1],coral:[1,127/255,80/255,1],cornflowerblue:[100/255,149/255,237/255,1],cornsilk:[1,248/255,220/255,1],crimson:[220/255,20/255,60/255,1],cyan:[0,1,1,1],darkblue:[0,0,139/255,1],darkcyan:[0,139/255,139/255,1],darkgoldenrod:[184/255,134/255,11/255,1],darkgray:[169/255,169/255,169/255,1],darkgreen:[0,100/255,0,1],darkgrey:[169/255,169/255,169/255,1],darkkhaki:[189/255,183/255,107/255,1],darkmagenta:[139/255,0,139/255,1],darkolivegreen:[85/255,107/255,47/255,1],darkorange:[1,140/255,0,1],darkorchid:[.6,50/255,.8,1],darkred:[139/255,0,0,1],darksalmon:[233/255,150/255,122/255,1],darkseagreen:[143/255,188/255,143/255,1],darkslateblue:[72/255,61/255,139/255,1],darkslategray:[47/255,79/255,79/255,1],darkslategrey:[47/255,79/255,79/255,1],darkturquoise:[0,206/255,209/255,1],darkviolet:[148/255,0,211/255,1],deeppink:[1,20/255,147/255,1],deepskyblue:[0,191/255,1,1],dimgray:[105/255,105/255,105/255,1],dimgrey:[105/255,105/255,105/255,1],dodgerblue:[30/255,144/255,1,1],firebrick:[178/255,34/255,34/255,1],floralwhite:[1,250/255,240/255
,1],forestgreen:[34/255,139/255,34/255,1],fuchsia:[1,0,1,1],gainsboro:[220/255,220/255,220/255,1],ghostwhite:[248/255,248/255,1,1],gold:[1,215/255,0,1],goldenrod:[218/255,165/255,32/255,1],gray:[128/255,128/255,128/255,1],green:[0,128/255,0,1],greenyellow:[173/255,1,47/255,1],grey:[128/255,128/255,128/255,1],honeydew:[240/255,1,240/255,1],hotpink:[1,105/255,180/255,1],indianred:[205/255,92/255,92/255,1],indigo:[75/255,0,130/255,1],ivory:[1,1,240/255,1],khaki:[240/255,230/255,140/255,1],lavender:[230/255,230/255,250/255,1],lavenderblush:[1,240/255,245/255,1],lawngreen:[124/255,252/255,0,1],lemonchiffon:[1,250/255,205/255,1],lightblue:[173/255,216/255,230/255,1],lightcoral:[240/255,128/255,128/255,1],lightcyan:[224/255,1,1,1],lightgoldenrodyellow:[250/255,250/255,210/255,1],lightgray:[211/255,211/255,211/255,1],lightgreen:[144/255,238/255,144/255,1],lightgrey:[211/255,211/255,211/255,1],lightpink:[1,182/255,193/255,1],lightsalmon:[1,160/255,122/255,1],lightseagreen:[32/255,178/255,170/255,1],lightskyblue:[135/255,206/255,250/255,1],lightslategray:[119/255,136/255,.6,1],lightslategrey:[119/255,136/255,.6,1],lightsteelblue:[176/255,196/255,222/255,1],lightyellow:[1,1,224/255,1],lime:[0,1,0,1],limegreen:[50/255,205/255,50/255,1],linen:[250/255,240/255,230/255,1],magenta:[1,0,1,1],maroon:[128/255,0,0,1],mediumaquamarine:[.4,205/255,170/255,1],mediumblue:[0,0,205/255,1],mediumorchid:[186/255,85/255,211/255,1],mediumpurple:[147/255,112/255,219/255,1],mediumseagreen:[60/255,179/255,113/255,1],mediumslateblue:[123/255,104/255,238/255,1],mediumspringgreen:[0,250/255,154/255,1],mediumturquoise:[72/255,209/255,.8,1],mediumvioletred:[199/255,21/255,133/255,1],midnightblue:[25/255,25/255,112/255,1],mintcream:[245/255,1,250/255,1],mistyrose:[1,228/255,225/255,1],moccasin:[1,228/255,181/255,1],navajowhite:[1,222/255,173/255,1],navy:[0,0,128/255,1],oldlace:[253/255,245/255,230/255,1],olive:[128/255,128/255,0,1],olivedrab:[107/255,142/255,35/255,1],orange:[1,165/255,0,1],orangered:[1,69/255,0,1],orchid:[218/255,112/255,214/255,1],palegoldenrod:[238/255,232/255,170/255,1],palegreen:[152/255,251/255,152/255,1],paleturquoise:[175/255,238/255,238/255,1],palevioletred:[219/255,112/255,147/255,1],papayawhip:[1,239/255,213/255,1],peachpuff:[1,218/255,185/255,1],peru:[205/255,133/255,63/255,1],pink:[1,192/255,203/255,1],plum:[221/255,160/255,221/255,1],powderblue:[176/255,224/255,230/255,1],purple:[128/255,0,128/255,1],red:[1,0,0,1],rosybrown:[188/255,143/255,143/255,1],royalblue:[65/255,105/255,225/255,1],saddlebrown:[139/255,69/255,19/255,1],salmon:[250/255,128/255,114/255,1],sandybrown:[244/255,164/255,96/255,1],seagreen:[46/255,139/255,87/255,1],seashell:[1,245/255,238/255,1],sienna:[160/255,82/255,45/255,1],silver:[192/255,192/255,192/255,1],skyblue:[135/255,206/255,235/255,1],slateblue:[106/255,90/255,205/255,1],slategray:[112/255,128/255,144/255,1],slategrey:[112/255,128/255,144/255,1],snow:[1,250/255,250/255,1],springgreen:[0,1,127/255,1],steelblue:[70/255,130/255,180/255,1],tan:[210/255,180/255,140/255,1],teal:[0,128/255,128/255,1],thistle:[216/255,191/255,216/255,1],tomato:[1,99/255,71/255,1],turquoise:[64/255,224/255,208/255,1],violet:[238/255,130/255,238/255,1],wheat:[245/255,222/255,179/255,1],white:[1,1,1,1],whitesmoke:[245/255,245/255,245/255,1],yellow:[1,1,0,1],yellowgreen:[154/255,205/255,50/255,1]},l={frustum:function(a,b,c,d,e,f,g){g||(g=l.create());var h=b-a,i=d-c,j=f-e;return g[0]=e*2/h,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=e*2/i,g[6]=0,g[7]=0,g[8]=(b+a)/h,g[9]=(d+c)/i,g[10]=-(f+e)/j,g[11]=-1,g[12]=0,g[13]=0,g[14]=-(f*e*2)/j,g[15]=0,g},perspective:function(a,b,c,d,e){var f=c*Math.tan(a*Math.PI/360),g=f*b;return l.frustum(-g,g,-f,f,c,d,e)}},m=function(){var b=0;return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(c){function g(){c(d+e)}var d,e,f;return d=(new Date).getTime(),e=Math.max(0,16-(d-b)),f=a.setTimeout(g,e),b=d+e,f}}();a.addEventListener("message",function(b){if(b.source===a&&b.data==="seriously-timeout-message"){b.stopPropagation();if(h.length>0){var c=h.shift();c()}}},!0),s.prototype.destroy=function(){var a=this.gl;a&&(a.deleteFramebuffer(this.frameBuffer),a.deleteRenderbuffer(this.renderBuffer),a.deleteTexture(this.texture)),delete this.frameBuffer,delete this.renderBuffer,delete this.texture},t.prototype.useProgram=function(){this.gl.useProgram(this.program)},u.prototype.benchmark=u.benchmark=function(b,d){function u(){if(p<s&&Date.now()-j<r){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,k),p++,q(u);return}t=1e3*p/(Date.now()-j),e=t,f(t>=h&&t)}var f=typeof b=="function"?b:d,g=typeof b!="function"&&b||{},h=isNaN(g.frameRate)?10:g.frameRate,i=g.timeLimit||2,j=Date.now(),k,l,m,n,o,p=0,r,s,t;if(!a.WebGLRenderingContext)return e=!1,!1;m=isNaN(g.width)||g.width<=0?!1:g.width,n=isNaN(g.height)||g.height<=0?!1:g.height,m?n||(n=m*9/16):n?m=n*16/9:(m=640,n=360);try{k=c.createElement("canvas"),k.width=m,k.height=n,l=k.getContext("experimental-webgl",{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0})}catch(v){if(k)try{l=k.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0})}catch(w){}}if(!l)return e=!1,!1;if(i){try{o=l.createTexture(),l.bindTexture(l.TEXTURE_2D,o)}catch(x){}r=i*1e3,s=isNaN(g.frames)||g.frames<=0?Math.max(h*i,20):g.frames;if(!f){while(p<s&&Date.now()-j<r)l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,k),p++;return t=1e3*p/(Date.now()-j),e=t,t<h?!1:t}u()}return!0},u.incompatible=function(d){var e,h,i;if(f===b){e=c.createElement("canvas");if(!e||!e.getContext)f="canvas";else if(!a.WebGLRenderingContext)f="webgl";else{try{h=e.getContext("experimental-webgl")}catch(j){try{h=e.getContext("webgl")}catch(k){}}h||(f="context")}}if(f)return f;if(d){i=g[d];if(i&&typeof i.compatible=="function"&&!i.compatible(h))return"plugin-"+d}return!1},u.plugin=function(a,c){function j(a){return a}var e=["render","initialize","original","width","height","transform","translate","translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","benchmark","plugin","alias","reset","prototype","destroy","isDestroyed"],f,h;if(g[a]){d.log("Effect ["+a+"] already loaded");return}if(!c)return;if(c.inputs)for(f in c.inputs){if(e.indexOf(f)>=0||Object.prototype[f])throw"Reserved effect input name: "+f;h=c.inputs[f],isNaN(h.min)&&(h.min=-Infinity),isNaN(h.max)&&(h.max=Infinity),isNaN(h.minCount)&&(h.minCount=-Infinity),isNaN(h.maxCount)&&(h.maxCount=Infinity),isNaN(h.step)&&(h.step=0);if(h.defaultValue===b||h.defaultValue===null)h.type==="number"?h.defaultValue=Math.min(Math.max(0,h.min),h.max):h.type==="color"?h.defaultValue=[0,0,0,0]:h.type==="enum"?h.options&&h.options.length?h.defaultValue=h.options[0]:h.defaultValue="":h.type==="boolean"?h.defaultValue=!1:h.defaultValue="";h.type==="vector"?h.dimensions<2?h.dimensions=2:h.dimensions>4?h.dimensions=4:!h.dimensions||isNaN(h.dimensions)?h.dimensions=4:h.dimensions=Math.round(h.dimensions):h.dimensions=1,h.shaderDirty=!!h.shaderDirty,typeof h.validate!="function"&&(h.validate=u.inputValidators[h.type]||j),!c.defaultImageInput&&h.type==="image"&&(c.defaultImageInput=f)}return c.title||(c.title=a),typeof c.requires!="function"&&(c.requires=!1),g[a]=c,i[a]=[],c},u.removePlugin=function(a){var b,c,d;if(!a)return this;d=g[a];if(!d)return this;b=i[a];if(b){while(b.length)c=b[0],c.destroy();delete i[a]}return delete g[a],this},u.inputValidators={color:function(a){var b,c,d;if(typeof a=="string"){b=/^(rgb|hsl)a?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*(\d+(\.\d*)?)\s*)?\)/i.exec(a);if(b&&b.length){if(b.length<3)return[0,0,0,0];c=[0,0,0,1];for(d=0;d<3;d++)c[d]=parseFloat(b[d+2])/255;return isNaN(b[6])||(c[3]=parseFloat(b[6])),b[1].toLowerCase()==="hsl"?p(c[0],c[1],c[2],c[3]):c}return b=/^#(([0-9a-fA-F]{3,8}))/.exec(a),b&&b.length?(b=b[1],b.length===3?c=[parseInt(b[0],16)/15,parseInt(b[1],16)/15,parseInt(b[2],16)/15,1]:b.length===4?c=[parseInt(b[0],16)/15,parseInt(b[1],16)/15,parseInt(b[2],16)/15,parseInt(b[3],16)/15]:b.length===6?c=[parseInt(b.substr(0,2),16)/255,parseInt(b.substr(2,2),16)/255,parseInt(b.substr(4,2),16)/255,1]:b.length===8?c=[parseInt(b.substr(0,2),16)/255,parseInt(b.substr(2,2),16)/255,parseInt(b.substr(4,2),16)/255,parseInt(b.substr(6,2),16)/255]:c=[0,0,0,0],c):(c=k[a.toLowerCase()],c?c:[0,0,0,0])}if(Array.isArray(a)){c=a;if(c.length<3)return[0,0,0,0];for(d=0;d<3;d++)if(isNaN(c[d]))return[0,0,0,0];return c.length<4&&c.push(1),c}return typeof a=="number"?[a,a,a,1]:[0,0,0,0]},number:function(a,b){return isNaN(a)?b.defaultValue||0:(a=parseFloat(a),a<b.min?b.min:a>b.max?b.max:b.step?Math.round(a/b.step)*b.step:a)},"enum":function(a,b){var c=b.options||[],d;return d=c.filter(function(b){return Array.isArray(b)&&b.length&&b[0]===a||b===a}),d.length?a:b.defaultValue||""},vector:function(a){var b,c,d,e=["x","y","z","w"];if(Array.isArray(a)){b={};for(c=0;c<4;c++)b[e[c]]=isNaN(a[c])?0:a[c];return b}if(typeof a=="object"){b={};for(c=0;c<4;c++)d=e[c],b[d]=isNaN(a[d])?0:a[d];return b}return{x:0,y:0,z:0,w:0}},"boolean":function(a){return a?a&&a.toLowerCase&&a.toLowerCase()==="false"?!1:!0:!1}},u.prototype.effects=u.effects=function(){var a,b,c,d={},e,f;for(a in g){b=g[a],c={title:b.title||a,description:b.description||"",inputs:{}};for(f in b.inputs)e=b.inputs[f],c.inputs[f]={type:e.type,defaultValue:e.defaultValue,step:e.step,min:e.min,max:e.max,minCount:e.minCount,maxCount:e.maxCount,dimensions:e.dimensions,title:e.title||f,description:e.description||"",options:e.options||[]};d[a]=c}return d},a.Float32Array&&(j=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),l.perspective(90,1,1,100,j));if(a.Seriously){if(typeof a.Seriously!="object")return;(function(){var b;for(b in a.Seriously)b!=="plugin"&&a.Seriously.hasOwnProperty(b)&&typeof a.Seriously[b]=="object"&&u.plugin(b,a.Seriously[b])})()}u.util={checkSource:r,hslToRgb:p,colors:k,setTimeoutZero:q,ShaderProgram:t,FrameBuffer:s,shader:{makeNoise:"float makeNoise(float u, float v, float timer) {\n	float x = u * v * mod(timer * 1000.0, 100.0);\n	x = mod(x, 13.0) * mod(x, 127.0);\n	float dx = mod(x, 0.01);\n	return clamp(0.1 + dx * 100.0, 0.0,1.0);\n}\n",random:"#ifndef RANDOM\n#define RANDOM\nfloat random(vec2 n) {\n	return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n#endif\n"}},u.util.shader.noiseHelpers="#ifndef NOISE_HELPERS\n#define NOISE_HELPERS\nvec2 mod289(vec2 x) {\n	return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n	return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n	return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n	return mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n	return mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r) {\n	return 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat taylorInvSqrt(float r) {\n	return 1.79284291400159 - 0.85373472095314 * r;\n}\n#endif\n",u.util.shader.snoise2d="#ifndef NOISE2D\n#define NOISE2D\nfloat snoise(vec2 v) {\n	const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n		0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n	   -0.577350269189626, // -1.0 + 2.0 * C.x\n		0.024390243902439); // 1.0 / 41.0\n	vec2 i = floor(v + dot(v, C.yy) );\n	vec2 x0 = v - i + dot(i, C.xx);\n	vec2 i1;\n	//i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n	//i1.y = 1.0 - i1.x;\n	i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n	// x0 = x0 - 0.0 + 0.0 * C.xx ;\n	// x1 = x0 - i1 + 1.0 * C.xx ;\n	// x2 = x0 - 1.0 + 2.0 * C.xx ;\n	vec4 x12 = x0.xyxy + C.xxzz;\n	x12.xy -= i1;\n	i = mod289(i); // Avoid truncation effects in permutation\n	vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 ));\n	vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n	m = m*m ;\n	m = m*m ;\n	vec3 x = 2.0 * fract(p * C.www) - 1.0;\n	vec3 h = abs(x) - 0.5;\n	vec3 ox = floor(x + 0.5);\n	vec3 a0 = x - ox;\n	m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n	vec3 g;\n	g.x = a0.x * x0.x + h.x * x0.y;\n	g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n	return 130.0 * dot(m, g);\n}\n#endif\n",u.util.shader.snoise3d="#ifndef NOISE3D\n#define NOISE3D\nfloat snoise(vec3 v) {\n	const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n	const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n	vec3 i = floor(v + dot(v, C.yyy) );\n	vec3 x0 = v - i + dot(i, C.xxx) ;\n	vec3 g = step(x0.yzx, x0.xyz);\n	vec3 l = 1.0 - g;\n	vec3 i1 = min( g.xyz, l.zxy );\n	vec3 i2 = max( g.xyz, l.zxy );\n	// x0 = x0 - 0.0 + 0.0 * C.xxx;\n	// x1 = x0 - i1 + 1.0 * C.xxx;\n	// x2 = x0 - i2 + 2.0 * C.xxx;\n	// x3 = x0 - 1.0 + 3.0 * C.xxx;\n	vec3 x1 = x0 - i1 + C.xxx;\n	vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n	vec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n	i = mod289(i);\n	vec4 p = permute( permute( permute(\n						 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n					 	+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n					 	+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n	float n_ = 0.142857142857; // 1.0/7.0\n	vec3 ns = n_ * D.wyz - D.xzx;\n	vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)\n	vec4 x_ = floor(j * ns.z);\n	vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)\n	vec4 x = x_ *ns.x + ns.yyyy;\n	vec4 y = y_ *ns.x + ns.yyyy;\n	vec4 h = 1.0 - abs(x) - abs(y);\n	vec4 b0 = vec4( x.xy, y.xy );\n	vec4 b1 = vec4( x.zw, y.zw );\n	//vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n	//vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n	vec4 s0 = floor(b0)*2.0 + 1.0;\n	vec4 s1 = floor(b1)*2.0 + 1.0;\n	vec4 sh = -step(h, vec4(0.0));\n	vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n	vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n	vec3 p0 = vec3(a0.xy,h.x);\n	vec3 p1 = vec3(a0.zw,h.y);\n	vec3 p2 = vec3(a1.xy,h.z);\n	vec3 p3 = vec3(a1.zw,h.w);\n	vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n	p0 *= norm.x;\n	p1 *= norm.y;\n	p2 *= norm.z;\n	p3 *= norm.w;\n	vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n	m = m * m;\n	return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n							                  dot(p2,x2), dot(p3,x3) ) );\n}\n#endif\n",u.util.shader.snoise4d="#ifndef NOISE4D\n#define NOISE4D\nvec4 grad4(float j, vec4 ip)\n	{\n	const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n	vec4 p,s;\n\n	p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n	p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n	s = vec4(lessThan(p, vec4(0.0)));\n	p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n	return p;\n	}\n\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n	{\n	const vec4 C = vec4(0.138196601125011, // (5 - sqrt(5))/20 G4\n						0.276393202250021, // 2 * G4\n						0.414589803375032, // 3 * G4\n						-0.447213595499958); // -1 + 4 * G4\n\n	vec4 i = floor(v + dot(v, vec4(F4)) );\n	vec4 x0 = v - i + dot(i, C.xxxx);\n\n\n	vec4 i0;\n	vec3 isX = step( x0.yzw, x0.xxx );\n	vec3 isYZ = step( x0.zww, x0.yyz );\n	i0.x = isX.x + isX.y + isX.z;\n	i0.yzw = 1.0 - isX;\n	i0.y += isYZ.x + isYZ.y;\n	i0.zw += 1.0 - isYZ.xy;\n	i0.z += isYZ.z;\n	i0.w += 1.0 - isYZ.z;\n\n	vec4 i3 = clamp( i0, 0.0, 1.0 );\n	vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n	vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n	vec4 x1 = x0 - i1 + C.xxxx;\n	vec4 x2 = x0 - i2 + C.yyyy;\n	vec4 x3 = x0 - i3 + C.zzzz;\n	vec4 x4 = x0 + C.wwww;\n\n	i = mod289(i);\n	float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n	vec4 j1 = permute( permute( permute( permute (\n						 i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n					 + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n					 + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n					 + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n	vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n	vec4 p0 = grad4(j0, ip);\n	vec4 p1 = grad4(j1.x, ip);\n	vec4 p2 = grad4(j1.y, ip);\n	vec4 p3 = grad4(j1.z, ip);\n	vec4 p4 = grad4(j1.w, ip);\n\n	vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n	p0 *= norm.x;\n	p1 *= norm.y;\n	p2 *= norm.z;\n	p3 *= norm.w;\n	p4 *= taylorInvSqrt(dot(p4,p4));\n\n	vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n	vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);\n	m0 = m0 * m0;\n	m1 = m1 * m1;\n	return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n							 + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n}\n#endif\n",a.Seriously=u})(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}};var c=document.createElement("img");c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvAAAAAICAYAAACf+MsnAAAFY0lEQVR4Xu2Z644bOwyDN+//0NsOigEMQdRHyU6CFDnA+bHVWNaFojiTx8/Pz+/f/4/89/v7z9Xj8Tjib3XyTN9usFcMz8gt3h9zXf/O6nD/W1V7Vb9uXad+nHucZ9xenX7OqTHdSfmRXfmPsSn8xPMrllcfCkdVfHSe7Ned0/yp7jv2GPfqK+MCByc0zzvxKi5RPq8cuvE4+JrwpFM7N78K2yu+qb9kd3qV+ZjUx5n/+xnXP81ctW/UHQ5P3Gd360vxKf+n8dGpxXTeKu6h2ansFT6pvo5G2/FP99NsUf9d/xleInfetcj629m9cf9WOV5K+78R8ERGRLYO8VQiecd/1vwKEJV46JBJRzhRfXftVL/MTgM48UmL0l2OSmzs9kctAJfE4/1KkNFzbj8cjFHsJ/u460vhnPDfqddujJ27poLCWWBuHt0YKr/ki+yOKJnk5Z7pPLfLf4TZif+qvi7XuDWg+HbtNEe79ds9H7m1m2/3+YzLK5Hc9e/gYxdfNP+ZfdV9lT3usWn+9310/qiAdxa1O5gTEqVhoLudxVwVNPrvCqDp/ZX4d0Uk1Y7sbgyU4zooCk8nB3i9Y61V5wWpIjDlP+ZJsxPvmLxEOD2sntk5Pz1LBOb0L+sPfQGs6ksYpt7QAiHuUwtkgl+F3Qyf2YxTX53+Vdjfjc8VYIq7KT+abzof7ervZ8fX8d/Jyc3PmTcnRrrPEbyVTnD8T+Y38pH624mfNIr6muzO95S/sh1Gvog/XmW/a6N+scww43zgqLjcOX9cwFeESQK3Gpx32QggTlwk8Ei8OXfE4VMLeCLQiLBjfJM7VA069XefnZBGJz7Vr24dK3GwEoqLD7p/1+4IMWdRdxaMK9CmP4E62F7nm8S7s4B3BMCkBzQPVQ0IM06+2WLvzlDlI+NfF4d0ljiHuF/Zb/4m/4ojTgnA6f0qfiWA135P5l/NoFv/7txm+5ZyyOw0e1R/skd8ZKKwwnjXf9xLrkBV+2x3Pib9Vz3JOMaNL/KZ+oCkXhDUTLxEwLsC41OfI5DEYe9+mXfr0l2mJH5ISHTOUw2U8IjD5LyVUtxEmrvi4V5ejvijWNWicBbOyfsrYejkMMXmdIFEAZH19ASWnNyrPlBdKH+yU3y0gGjGKf4Mv51ft9zzKk83vul5qr9r7+CT9gHx2zvs0/yofpGX1AuC4svqhYJeJJydNZk/urcSxet91dfiUy94HX6oBHCHi5+F38svCeg1h+zZ6nyF5VUzVC8Q0X9LwE/IkMjmpJ3i27XvxuqQ0c4dp/JTfnb9T847AoNIW/nokIYrYKvnJvln/siPwtD0XAeTU+x0luEugWdLNeY4ecl260vxK8Efl3OnZi4uaZZIMBFeJ/hw6xrFvppvV1Q559d8MwwR50cskIBQ2KhE3y7/ZeddAUjxOr3diZ/8U3+I953z7uzR7Lj4rvjl9HxXvaHaOflSfSkf93y24xx94PpX89I5H2t9+fwK+KVzNOwdIeM+e905+ZqqRIj7pYHiU3FNFnBnkO+41EKige3cpX7GunwoARfjIwKrxNhEJFLfMrsbI+G/smfkojAa60vxPcNeCZCqhjSra6ydBaAWSFzaqnb01c4VEdVCWWPM7svstKDWuKrZpwUb7dVsOzPcxUeGdYdfdgV8Vr+Mv1R8Tn/iHcSNWR8jjjv9URzama9qbp0XlBP4y2Jw6u/E577AZTVz/BM/OfySzSjl79o73FRxaFdfuPG5/XE58PbXEvAT8UBn1HKuSIB8ThYwiZfJnd8z768Aib/3R/iN4J0VeMXcVwvynbl/735OBV6BKTfyT+e/T4/f7dP3uW8F3Aqs/PIHbWXeeeKjnSsAAAAASUVORK5CYII=",Seriously.plugin("ascii",function(){var a,b,d,e,f,g,h,i,j;return{initialize:function(a){function b(){e.bindTexture(e.TEXTURE_2D,d),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c),e.bindTexture(e.TEXTURE_2D,null)}var f=this;a(),e=this.gl,d=e.createTexture(),c.naturalWidth?b():c.addEventListener("load",function(){b(),f.setDirty()}),j={letters:d},e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,null)},shader:function(b,c,d){return a=new Seriously.util.ShaderProgram(this.gl,c.vertex,c.fragment),c.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform sampler2D letters;\nuniform vec2 dim;\n\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\nconst vec2 fontSize = vec2(8.0, 8.0);\n\nvec4 lookup(float ascii) {\n	vec2 pos = mod(vTexCoord * dim, fontSize) / vec2(752.0, fontSize.x) + vec2(ascii, 0.0);\n	return texture2D(letters, pos);\n}\n\nvoid main(void) {\n	vec4 sample = texture2D(source, vTexCoord);\n	float luma = dot(sample.rgb,lumcoeff);\n	vec4 clamped = vec4(floor(sample.rgb * 8.0) / 8.0, sample.a);\n	float char = floor(luma * 94.0) / 94.0;\n	gl_FragColor = clamped * lookup(char);\n}\n",c},draw:function(c,d,k,l,m){if(g!==this.height||f!==this.width)g=this.height,f=this.width,h=Math.ceil(f/8),i=Math.ceil(g/8),j.dim=[f,g],b=new Seriously.util.FrameBuffer(e,h,i),e.bindTexture(e.TEXTURE_2D,b.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);m(a,d,k,b.frameBuffer,!1,{width:h,height:i,blend:!1}),j.transform=k.transform,j.source=b.texture,m(c,d,j,l)},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},description:"Display image as ascii text in 8-bit color.",title:"Ascii Text"}}())}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("bleach-bypass",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\n\nuniform float amount;\n\n//constant variables.\nconst vec4 one = vec4(1.0);\nconst vec4 two = vec4(2.0);\nconst vec4 lumcoeff = vec4(0.2125,0.7154,0.0721,0.0);\n\nvec4 overlay(vec4 myInput, vec4 previousmix, vec4 amount) {\n	float luminance = dot(previousmix,lumcoeff);\n	float mixamount = clamp((luminance - 0.45) * 10.0, 0.0, 1.0);\n\n	vec4 branch1 = two * previousmix * myInput;\n	vec4 branch2 = one - (two * (one - previousmix) * (one - myInput));\n\n	vec4 result = mix(branch1, branch2, vec4(mixamount) );\n\n	return mix(previousmix, result, amount);\n}\n\nvoid main (void)  {\n	vec4 pixel = texture2D(source, vTexCoord);\n	vec4 luma = vec4(vec3(dot(pixel,lumcoeff)), pixel.a);\n	gl_FragColor = overlay(luma, pixel, vec4(amount));\n\n} \n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:1,min:0,max:1}},title:"Bleach Bypass",categories:["film"],description:'Bleach Bypass film treatment\nhttp://en.wikipedia.org/wiki/Bleach_bypass\nsee: "Saving Private Ryan", "Minority Report"'})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("blend",function(){var a={normal:"BlendNormal",lighten:"BlendLighten",darken:"BlendDarken",multiply:"BlendMultiply",average:"BlendAverage",add:"BlendAdd",subtract:"BlendSubtract",difference:"BlendDifference",negation:"BlendNegation",exclusion:"BlendExclusion",screen:"BlendScreen",overlay:"BlendOverlay",softlight:"BlendSoftLight",hardlight:"BlendHardLight",colordodge:"BlendColorDodge",colorburn:"BlendColorBurn",lineardodge:"BlendLinearDodge",linearburn:"BlendLinearBurn",linearlight:"BlendLinearLight",vividlight:"BlendVividLight",pinlight:"BlendPinLight",hardmix:"BlendHardMix",reflect:"BlendReflect",glow:"BlendGlow",phoenix:"BlendPhoenix"};return{initialize:function(a){a()},shader:function(b,c,d){var e=b.mode||"normal";return e=e.toLowerCase(),e=a[e]||"BlendNormal",c.fragment="#define BlendFunction "+e+"\n"+"#ifdef GL_ES\n\n"+"precision mediump float;\n\n"+"#endif\n\n"+"\n"+"#define BlendLinearDodgef				BlendAddf\n"+"#define BlendLinearBurnf				BlendSubtractf\n"+"#define BlendAddf(base, blend)			min(base + blend, 1.0)\n"+"#define BlendSubtractf(base, blend)	max(base + blend - 1.0, 0.0)\n"+"#define BlendLightenf(base, blend)		max(blend, base)\n"+"#define BlendDarkenf(base, blend)		min(blend, base)\n"+"#define BlendLinearLightf(base, blend)	(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))\n"+"#define BlendScreenf(base, blend)		(1.0 - ((1.0 - base) * (1.0 - blend)))\n"+"#define BlendOverlayf(base, blend)		(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n"+"#define BlendSoftLightf(base, blend)	((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))\n"+"#define BlendColorDodgef(base, blend)	((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))\n"+"#define BlendColorBurnf(base, blend)	((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))\n"+"#define BlendVividLightf(base, blend)	((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))\n"+"#define BlendPinLightf(base, blend)	((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))\n"+"#define BlendHardMixf(base, blend)		((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)\n"+"#define BlendReflectf(base, blend)		((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))\n"+"#define Blend(base, blend, funcf)		vec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))\n"+"#define BlendNormal(base, blend)		(blend)\n"+"#define BlendLighten					BlendLightenf\n"+"#define BlendDarken					BlendDarkenf\n"+"#define BlendMultiply(base, blend)		(base * blend)\n"+"#define BlendAverage(base, blend)		((base + blend) / 2.0)\n"+"#define BlendAdd(base, blend)			min(base + blend, vec3(1.0))\n"+"#define BlendSubtract(base, blend)	max(base + blend - vec3(1.0), vec3(0.0))\n"+"#define BlendDifference(base, blend)	abs(base - blend)\n"+"#define BlendNegation(base, blend)		(vec3(1.0) - abs(vec3(1.0) - base - blend))\n"+"#define BlendExclusion(base, blend)	(base + blend - 2.0 * base * blend)\n"+"#define BlendScreen(base, blend)		Blend(base, blend, BlendScreenf)\n"+"#define BlendOverlay(base, blend)		Blend(base, blend, BlendOverlayf)\n"+"#define BlendSoftLight(base, blend)	Blend(base, blend, BlendSoftLightf)\n"+"#define BlendHardLight(base, blend)	BlendOverlay(blend, base)\n"+"#define BlendColorDodge(base, blend)	Blend(base, blend, BlendColorDodgef)\n"+"#define BlendColorBurn(base, blend)	Blend(base, blend, BlendColorBurnf)\n"+"#define BlendLinearDodge				BlendAdd\n"+"#define BlendLinearBurn				BlendSubtract\n"+"#define BlendLinearLight(base, blend)	Blend(base, blend, BlendLinearLightf)\n"+"#define BlendVividLight(base, blend)	Blend(base, blend, BlendVividLightf)\n"+"#define BlendPinLight(base, blend)		Blend(base, blend, BlendPinLightf)\n"+"#define BlendHardMix(base, blend)		Blend(base, blend, BlendHardMixf)\n"+"#define BlendReflect(base, blend)		Blend(base, blend, BlendReflectf)\n"+"#define BlendGlow(base, blend)			BlendReflect(blend, base)\n"+"#define BlendPhoenix(base, blend)		(min(base, blend) - max(base, blend) + vec3(1.0))\n"+"#define BlendOpacity(base, blend, F, O, A)	((F(base.rgb * blend.a * O, blend.rgb * blend.a * O) + base.rgb * base.a * (1.0 - blend.a * O)) / A)\n"+"\n"+"varying vec2 vTexCoord;\n"+"varying vec4 vPosition;\n"+"\n"+"uniform sampler2D top;\n"+"\n"+"uniform sampler2D bottom;\n"+"\n"+"uniform float opacity;\n"+"\n"+"void main(void) {\n"+"	vec3 color;\n"+"	vec4 topPixel = texture2D(top, vTexCoord);\n"+"	vec4 bottomPixel = texture2D(bottom, vTexCoord);\n"+"	float alpha = topPixel.a + bottomPixel.a * (1.0 - topPixel.a);\n"+"	if (alpha == 0.0) {\n"+"		color = vec3(0.0);\n"+"	} else {\n"+"		color = BlendOpacity(bottomPixel, topPixel, BlendFunction, opacity, alpha);\n"+"	}\n"+"	gl_FragColor = vec4(color, alpha);\n"+"}\n",c},inPlace:!0,inputs:{top:{type:"image",uniform:"top"},bottom:{type:"image",uniform:"bottom"},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1},mode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["substract","Substract"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight","Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight","Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"]]}},description:"Blend two layers",title:"Blend"}}())}(window),function(a,b){function f(a,c,d){var f;return typeof a=="string"?(f=a.charAt(0).toLowerCase(),f=e[f],f===b&&(f=-1),f<0&&(f=parseFloat(a))):f=a,f===0||f===1||f===2||f===3?f:this.inputs[d]}"use strict";var c=a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},d=["Red","Green","Blue","Alpha"],e={r:0,g:1,b:2,a:3,x:0,y:1,z:2,w:3};c.plugin("channels",function(){var a=[],b=[],e=[[],[],[],[]];return{shader:function(d,f,g){function p(a,c){var e,f;e=d[a],e||(e=d[a]=d.source),f=b.indexOf(e),f<0&&(f=b.length,b.push(e))}var h,i,j,k,l="",m="",n,o;b.splice(0,b.length),p("redSource"),p("greenSource"),p("blueSource"),p("alphaSource");for(h=0;h<b.length;h++){n=b[h],o=e[h];for(i=0;i<16;i++)o[i]=0;o[d.red]=d.redSource===n?1:0,o[4+d.green]=d.greenSource===n?1:0,o[8+d.blue]=d.blueSource===n?1:0,o[12+d.alpha]=d.alphaSource===n?1:0,this.uniforms["source"+h]=n,this.uniforms["channel"+h]=o}if(a[b.length])return a[b.length];for(h=0;h<b.length;h++)l+="uniform sampler2D source"+h+";\n"+"uniform mat4 channel"+h+";\n",m+="gl_FragColor += texture2D(source"+h+", vTexCoord) * channel"+h+";\n";return j="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\n"+l+"\n"+"void main(void) {\n"+"	gl_FragColor = vec4(0.0);\n"+m+"}\n",k=new c.util.ShaderProgram(this.gl,f.vertex,j),a[b.length]=k,k},inPlace:!0,inputs:{source:{type:"image",shaderDirty:!0},redSource:{type:"image",shaderDirty:!0},greenSource:{type:"image",shaderDirty:!0},blueSource:{type:"image",shaderDirty:!0},alphaSource:{type:"image",shaderDirty:!0},red:{type:"enum",options:d,validate:f,defaultValue:0},green:{type:"enum",options:d,validate:f,defaultValue:1},blue:{type:"enum",options:d,validate:f,defaultValue:2},alpha:{type:"enum",options:d,validate:f,defaultValue:3}},title:"Channel Mapping",description:""}}())}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("chroma",{shader:function(a,b,c){return b.vertex="#ifdef GL_ES\nprecision mediump float;\n#endif \n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nuniform mat4 transform;\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform vec4 screen;\nuniform float balance;\nvarying float screenSat;\nvarying vec3 screenPrimary;\n\nvoid main(void) {\n	float fmin = min(min(screen.r, screen.g), screen.b);    //Min. value of RGB\n	float fmax = max(max(screen.r, screen.g), screen.b);    //Max. value of RGB\n	float secondaryComponents;\n\n	screenPrimary = step(fmax, screen.rgb);\n	secondaryComponents = dot(1.0 - screenPrimary, screen.rgb);\n	screenSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n\n	gl_Position = vec4(position, 1.0);\n	vTexCoord = vec2(texCoord.s, texCoord.t);\n}\n",b.fragment="#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform vec4 screen;\nuniform float screenWeight;\nuniform float balance;\nuniform float clipBlack;\nuniform float clipWhite;\n\nvarying float screenSat;\nvarying vec3 screenPrimary;\n\nvec4 sourcePixel;\n\nconst mat3 yuv = mat3(\n	54.213, 182.376, 18.411,\n	-54.213, -182.376, 236.589,\n	200.787, -182.376, -18.411\n);\n\nfloat round(float n) {\n	return floor(n) + step(0.5, fract(n));\n}\n\nvoid main(void) {\n	float pixelSat, luminance, secondaryComponents;\n	vec3 pixelPrimary;\n	vec4 pixel = vec4(0.0);\n	sourcePixel = texture2D(source, vTexCoord);\n	float fmin = min(min(sourcePixel.r, sourcePixel.g), sourcePixel.b);    //Min. value of RGB\n	float fmax = max(max(sourcePixel.r, sourcePixel.g), sourcePixel.b);    //Max. value of RGB\n\n	luminance = fmax; // Luminance\n	pixelPrimary = step(fmax, sourcePixel.rgb);\n	secondaryComponents = dot(1.0 - pixelPrimary, sourcePixel.rgb);\n	pixelSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);\n	if (pixelSat < 0.1 || luminance < 0.1 || any(notEqual(pixelPrimary, screenPrimary))) {\n		pixel = sourcePixel;\n	} else if (pixelSat < screenSat) {\n		float alpha = 1.0 - pixelSat / screenSat;\n		alpha = smoothstep(clipBlack, clipWhite, alpha);\n		pixel = vec4((sourcePixel.rgb - (1.0 - alpha) * screen.rgb * screenWeight) / alpha, alpha);\n	}\n	gl_FragColor = pixel;\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},screen:{type:"color",uniform:"screen",defaultValue:[66/255,195/255,31/255,1]},weight:{type:"number",uniform:"screenWeight",defaultValue:1,min:0},balance:{type:"number",uniform:"balance",defaultValue:1,min:0,max:1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1}},title:"Chroma Key",description:""})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("color",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform vec4 color;\n\nvoid main(void) {\n	gl_FragColor = color;\n}\n"
,b},inPlace:!0,inputs:{color:{type:"color",uniform:"color",defaultValue:[0,0,0,1]}},title:"Color",description:"Generate color"})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("colorcube",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform sampler2D source;\nuniform sampler2D colorCube;\nvarying vec2 vTexCoord;\nvec3 sampleAs3DTexture(sampler2D tex, vec3 coord, float size) {\n	float sliceSize = 1.0 / size;                         // space of 1 slice\n	float slicePixelSize = sliceSize / size;              // space of 1 pixel\n	float sliceInnerSize = slicePixelSize * (size - 1.0); // space of size pixels\n	float zSlice0 = min(floor(coord.z * size), size - 1.0);\n	float zSlice1 = min(zSlice0 + 1.0, size - 1.0);\n	float xOffset = slicePixelSize * 0.5 + coord.x * sliceInnerSize;\n	float s0 = xOffset + (zSlice0 * sliceSize);\n	float s1 = xOffset + (zSlice1 * sliceSize);\n	vec3 slice0Color = texture2D(tex, vec2(s0, 1.0 - coord.y)).rgb;\n	vec3 slice1Color = texture2D(tex, vec2(s1, 1.0 - coord.y)).rgb;\n	float zOffset = mod(coord.z * size, 1.0);\n	return mix(slice0Color, slice1Color, zOffset);\n}\nvoid main(void) {\n	vec4 originalColor = texture2D(source, vTexCoord);\n	vec3 color = sampleAs3DTexture(colorCube, originalColor.rgb, 8.0);\n	gl_FragColor = vec4(color, originalColor.a);\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},cube:{type:"image",uniform:"colorCube"}},title:"Color Cube",description:""})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("edge",function(){function h(a,b){var c;for(c=0;c<b.length;c++)b[c]*=a;return b}var a=Math.sqrt,b,c,d=[],e,f,g;e=[h(1/(2*a(2)),[1,a(2),1,0,0,0,-1,-a(2),-1]),h(1/(2*a(2)),[1,0,-1,a(2),0,-a(2),1,0,-1]),h(1/(2*a(2)),[0,-1,a(2),1,0,-1,-a(2),1,0]),h(1/(2*a(2)),[a(2),-1,0,-1,0,1,0,1,-a(2)]),h(.5,[0,1,0,-1,0,-1,0,1,0]),h(.5,[-1,0,1,0,0,0,1,0,-1]),h(1/6,[1,-2,1,-2,4,-2,1,-2,1]),h(1/6,[-2,1,-2,1,4,1,-2,1,-2]),h(1/3,[1,1,1,1,1,1,1,1,1])];for(b=0;b<e.length;b++)for(c=0;c<e[b].length;c++)d.push(e[b][c]);return f=new Float32Array(d),g=new Float32Array([1,2,1,0,0,0,-1,-2,-1,1,0,-1,2,0,-2,1,0,-1]),{shader:function(a,b,c){var d;return a.mode==="sobel"?d="#define N_MATRICES 2\n#define SOBEL\n":d="#define N_MATRICES 9\n",b.fragment=d+"#ifdef GL_ES\n"+"precision mediump float;\n"+"#endif\n"+"\n"+"varying vec2 vTexCoord;\n"+"varying vec4 vPosition;\n"+"\n"+"uniform sampler2D source;\n"+"uniform float pixelWidth;\n"+"uniform float pixelHeight;\n"+"uniform mat3 G[9];\n"+"\n"+"void main(void) {\n"+"	mat3 I;\n"+"	float dp3, cnv[9];\n"+"	vec3 tc;\n"+"	float fi = 0.0, fj = 0.0;\n"+"	for (int i = 0; i < 3; i++) {\n"+"		fj = 0.0;\n"+"		for (int j = 0; j < 3; j++) {\n"+"			I[i][j] = length( "+"texture2D(source, "+"vTexCoord + vec2((fi - 1.0) * pixelWidth, (fj - 1.0) * pixelHeight)"+").rgb );\n"+"			fj += 1.0;\n"+"		};\n"+"		fi += 1.0;\n"+"	};\n"+"	for (int i = 0; i < N_MATRICES; i++) {\n"+"		dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n"+"		cnv[i] = dp3 * dp3;\n"+"	};\n"+"\n"+"#ifdef SOBEL\n"+"	tc = vec3(0.5 * sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));\n"+"#else\n"+"	float M = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]);\n"+"	float S = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]) + (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + cnv[8];\n"+"	tc = vec3(sqrt(M/S));\n"+"#endif\n"+"	gl_FragColor = vec4(tc, 1.0);\n"+"}\n",b},draw:function(a,b,c,d,e){c.pixelWidth=1/this.width,c.pixelHeight=1/this.height,this.inputs.mode==="sobel"?c["G[0]"]=g:c["G[0]"]=f,e(a,b,c,d)},inputs:{source:{type:"image",uniform:"source"},mode:{type:"enum",shaderDirty:!0,defaultValue:"sobel",options:[["sobel","Sobel"],["frei-chen","Frei-Chen"]]}},description:"Edge Detect",title:"Edge Detect"}}())}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("emboss",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform float amount;\n\nuniform vec2 dim;\n\nconst vec3 average = vec3(1.0 / 3.0);\n\nvoid main (void)  {\n	vec2 offset = 1.0 / dim;\n	vec4 pixel = vec4(0.5, 0.5, 0.5, 1.0);\n	pixel -= texture2D(source, vTexCoord - offset) * amount;\n	pixel += texture2D(source, vTexCoord + offset) * amount;\n	float val = dot(pixel.rgb, average);\n	pixel.rgb = vec3(val);\n	gl_FragColor = pixel;\n\n} \n",b},draw:function(a,b,c,d,e){c.dim||(c.dim=[]),c.dim[0]=this.width,c.dim[1]=this.height,e(a,b,c,d)},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:1}},title:"Emboss",categories:[],description:"Emboss"})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("exposure",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\n\nuniform float exposure;\n\n//constant variables.\nconst float sqrtoftwo = 1.41421356237;\n\n\nvoid main (void)  {\n	vec4 pixel = texture2D(source, vTexCoord);\n	gl_FragColor = log2(vec4(pow(exposure + sqrtoftwo, 2.0))) * pixel;\n\n} \n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},exposure:{type:"number",uniform:"exposure",defaultValue:0,min:0,max:1}},title:"Exposure",categories:["film"],description:"Exposure control"})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("fader",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform vec4 color;\nuniform float amount;\n\nvoid main(void) {\n	gl_FragColor = texture2D(source, vTexCoord);\n	gl_FragColor = mix(gl_FragColor, color, amount);\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},color:{type:"color",uniform:"color",defaultValue:[0,0,0,1]},amount:{type:"number",uniform:"amount",defaultValue:1,min:0,max:1}},title:"Fader",description:"Fade image to a color"})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("hex",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform vec3 srsSize;\nuniform vec2 center;\nuniform float size;\n\nvoid main(void) {\n	vec2 aspect = normalize(srsSize.xy);\n	vec2 tex = (vTexCoord * aspect - center) / size;\n	tex.y /= 0.866025404;\n	tex.x -= tex.y * 0.5;\n	vec2 a;\n	if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n		a = vec2(floor(tex.x), floor(tex.y));\n	} else {\n		a = vec2(ceil(tex.x), ceil(tex.y));\n	}\n	vec2 b = vec2(ceil(tex.x), floor(tex.y));\n	vec2 c = vec2(floor(tex.x), ceil(tex.y));\n	vec3 tex3 = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n	vec3 a3 = vec3(a.x, a.y, 1.0 - a.x - a.y);\n	vec3 b3 = vec3(b.x, b.y, 1.0 - b.x - b.y);\n	vec3 c3 = vec3(c.x, c.y, 1.0 - c.x - c.y);\n	float alen =length(tex3 - a3);\n	float blen =length(tex3 - b3);\n	float clen =length(tex3 - c3);\n	vec2 choice;\n	if (alen < blen) {\n		if (alen < clen) {\n			choice = a;\n		} else {\n			choice = c;\n		}\n	} else {\n		if (blen < clen) {\n			choice = b;\n		} else {\n			choice = c;\n		}\n	}\n	choice.x += choice.y * 0.5;\n	choice.y *= 0.866025404;\n	choice *= size / aspect;\n	gl_FragColor = texture2D(source, choice + center / aspect);\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},size:{type:"number",uniform:"size",min:0,max:2,defaultValue:.01},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0,0]}},title:"Hex",description:"Hexagonal Pixelate"})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("hue-saturation",{shader:function(a,b,c){return b.vertex="#ifdef GL_ES\nprecision mediump float;\n#endif \n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nuniform mat4 transform;\n\nuniform float hue;\nuniform float saturation;\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nvarying vec3 weights;\n\nvoid main(void) {\n	float angle = hue * 3.14159265358979323846264;\n	float s = sin(angle);\n	float c = cos(angle);\n	weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\n	gl_Position = transform * vec4(position, 1.0);\n	vTexCoord = vec2(texCoord.s, texCoord.t);\n}\n",b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nvarying vec3 weights;\n\nuniform sampler2D source;\nuniform float hue;\nuniform float saturation;\n\nvoid main(void) {\n	vec4 color = texture2D(source, vTexCoord);\n	float len = length(color.rgb);\n	color.rgb = vec3(dot(color.rgb, weights.xyz), dot(color.rgb, weights.zxy), dot(color.rgb, weights.yzx) );\n	vec3 adjustment = (color.r + color.g + color.b) / 3.0 - color.rgb;\n	if (saturation > 0.0) {\n		adjustment *= (1.0 - 1.0 / (1.0 - saturation));\n	} else {\n		adjustment *= (-saturation);\n	}\n	color.rgb += adjustment;\n	gl_FragColor = color;\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hue:{type:"number",uniform:"hue",defaultValue:0,min:-1,max:1},saturation:{type:"number",uniform:"saturation",defaultValue:0,min:-1,max:1}},title:"Hue/Saturation",description:"Rotate hue and multiply saturation."})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("invert",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\n\nvoid main(void) {\n	gl_FragColor = texture2D(source, vTexCoord);\n	gl_FragColor = vec4(1.0 - gl_FragColor.rgb, gl_FragColor.a);\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Invert",description:"Invert image color"})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("lumakey",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\n\nuniform float threshold;\nuniform float clipBlack;\nuniform float clipWhite;\n\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\n\nvoid main (void)  {\n	vec4 pixel = texture2D(source, vTexCoord);\n	float luma = dot(pixel.rgb,lumcoeff);\n	float alpha = 1.0 - smoothstep(clipBlack, clipWhite, luma);\n	gl_FragColor = vec4(pixel.rgb, min(pixel.a, alpha) );\n\n} \n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:.9,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1}},title:"Luma Key",categories:["key"],description:""})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("nightvision",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform float timer;\nuniform float luminanceThreshold;\nuniform float amplification;\nuniform vec3 nightVisionColor;\n\n"+c.shader.makeNoise+"\n"+"void main(void) {\n"+"	vec3 noise = vec3("+"makeNoise(vTexCoord.x, vTexCoord.y, timer), "+"makeNoise(vTexCoord.x, vTexCoord.y, timer * 200.0 + 1.0), "+"makeNoise(vTexCoord.x, vTexCoord.y, timer * 100.0 + 3.0)"+");\n"+"	vec4 pixel = texture2D(source, vTexCoord + noise.xy * 0.0025);\n"+"	float luminance = dot(vec3(0.299, 0.587, 0.114), pixel.rgb);\n"+"	pixel.rgb *= step(luminanceThreshold, luminance) * amplification;\n"+"	gl_FragColor = vec4( (pixel.rgb + noise * 0.1) * nightVisionColor, pixel.a);\n"+"}\n",b},inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},timer:{type:"number",uniform:"timer",defaultValue:0},luminanceThreshold:{type:"number",uniform:"luminanceThreshold",defaultValue:.2,min:0,max:1},amplification:{type:"number",uniform:"amplification",defaultValue:3,min:0},color:{type:"color",uniform:"nightVisionColor",defaultValue:[.1,.95,.2]}},title:"Night Vision",description:""})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("noise",function(){return{shader:function(a,b,c){var d;return d="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\n#define Blend(base, blend, funcf)		vec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))\n#define BlendOverlayf(base, blend) (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))\n#define BlendOverlay(base, blend)		Blend(base, blend, BlendOverlayf)\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\n\nuniform vec3 srsSize;\nuniform float amount;\nuniform float timer;\n"+c.shader.noiseHelpers+c.shader.snoise3d+c.shader.random+"void main(void) {\n"+"	vec4 pixel = texture2D(source, vTexCoord);\n"+"	float r = random(vec2(timer * vTexCoord.xy));\n"+"	float noise = snoise(vec3(vTexCoord * (1024.4 + r * 512.0), timer)) * 0.5;",a.overlay?d+="	vec3 overlay = BlendOverlay(pixel.rgb, vec3(noise));\n	pixel.rgb = mix(pixel.rgb, overlay, amount);\n":d+="	pixel.rgb += noise * amount;\n",d+="	gl_FragColor = pixel;\n}",b.fragment=d,b},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},overlay:{type:"boolean",shaderDirty:!0,defaultValue:!0},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:1},timer:{type:"number",uniform:"timer",defaultValue:0,step:1}},title:"Noise",description:"Add noise"}}())}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("ripple",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform float wave;\nuniform float distortion;\nuniform vec2 center;\n\nvoid main(void) {\n	float scalar = abs(1.0 - abs(distance(vTexCoord, center)));\n	float sinOffset = sin(wave / scalar);\n	sinOffset = clamp(sinOffset, 0.0, 1.0);\n	float sinSign = cos(wave / scalar);\n	sinOffset = sinOffset * distortion / 32.0;\n	gl_FragColor = texture2D(source, vTexCoord + sinOffset * sinSign);\n}\n",b},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},wave:{type:"number",uniform:"wave",defaultValue:Math.PI/.75},distortion:{type:"number",uniform:"distortion",defaultValue:1},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:{x:.5,y:.5}}},title:"Ripple Distortion",description:""})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("scanlines",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform float lines;\nuniform float width;\nuniform float intensity;\n\nvoid main(void) {\n	vec4 pixel = texture2D(source, vTexCoord);\n	float darken = 2.0 * abs( fract(vTexCoord.y * lines) - 0.5);\n	darken = clamp(darken - width + 0.5, 0.0, 1.0);\n	darken = 1.0 - ((1.0 - darken) * intensity);\n	gl_FragColor = vec4(pixel.rgb * darken, 1.0);\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},lines:{type:"number",uniform:"lines",defaultValue:60},size:{type:"number",uniform:"size",defaultValue:.2,min:0,max:1},intensity:{type:"number",uniform:"intensity",defaultValue:.1,min:0,max:1}},title:"Scan Lines",description:""})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("sepia",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\n\nconst mat4 coeff = mat4(0.393, 0.349, 0.272, 1.0,0.796, 0.686, 0.534, 1.0, 0.189, 0.168, 0.131, 1.0, 0.0, 0.0, 0.0, 1.0 );\n\nvoid main(void) {\n	vec4 sourcePixel = texture2D(source, vTexCoord);\n	gl_FragColor = coeff * sourcePixel;\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Sepia",description:""})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("split",function(){var a;return{initialize:function(a){a()},shader:function(b,c,d){return a=new Seriously.util.ShaderProgram(this.gl,c.vertex,c.fragment),c.vertex="#ifdef GL_ES\nprecision mediump float;\n#endif \n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nuniform mat4 transform;\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform float angle;\nvarying float c;\nvarying float s;\nvarying float t;\n\nvoid main(void) {\n   c = cos(angle);\n   s = sin(angle);\n	t = abs(c + s);\n\n	gl_Position = transform * vec4(position, 1.0);\n	vTexCoord = vec2(texCoord.s, texCoord.t);\n}\n",c.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nvarying float c;\nvarying float s;\nvarying float t;\n\nuniform sampler2D sourceA;\nuniform sampler2D sourceB;\nuniform float split;\nuniform float angle;\nuniform float fuzzy;\n\nvoid main(void) {\n	vec4 pixel1 = texture2D(sourceA, vTexCoord);\n	vec4 pixel2 = texture2D(sourceB, vTexCoord);\n	gl_FragColor = mix(pixel2, pixel1, smoothstep((split - fuzzy * (1.0 - split)) * t, (split + fuzzy * split) * t, c * vTexCoord.x + s * vTexCoord.y));\n}\n",c},draw:function(b,c,d,e,f){if(d.split>=1){d.source=d.sourceB,f(a,c,d,e);return}if(d.split<=0){d.source=d.sourceA,f(a,c,d,e);return}f(b,c,d,e)},inPlace:!1,requires:function(a,b){return a==="sourceA"&&b.split>=1?!1:a==="sourceB"&&b.split<=0?!1:!0},inputs:{sourceA:{type:"image",uniform:"sourceA",shaderDirty:!1},sourceB:{type:"image",uniform:"sourceB",shaderDirty:!1},split:{type:"number",uniform:"split",defaultValue:.5,min:0,max:1},angle:{type:"number",uniform:"angle",defaultValue:0},fuzzy:{type:"number",uniform:"fuzzy",defaultValue:0,min:0,max:1}},description:"Split screen or wipe",title:"Split"}}())}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("tone",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform vec4 light;\nuniform vec4 dark;\nuniform float desat;\nuniform float toned;\n\nconst vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);\n\nvoid main(void) {\n	vec4 sourcePixel = texture2D(source, vTexCoord);\n	vec3 sceneColor = light.rgb * sourcePixel.rgb;\n	vec3 gray = vec3(dot(lumcoeff, sceneColor));\n	vec3 muted = mix(sceneColor, gray, desat);\n	vec3 tonedColor = mix(dark.rgb, light.rgb, gray);\n	gl_FragColor = vec4(mix(muted, tonedColor, toned), sourcePixel.a);\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},light:{type:"color",uniform:"light",defaultValue:[1,.9,.5,1]},dark:{type:"color",uniform:"dark",defaultValue:[.2,.05,0,1]},toned:{type:"number",uniform:"toned",defaultValue:1,minimumRange:0,maximumRange:1},desat:{type:"number",uniform:"desat",defaultValue:.5,minimumRange:0,maximumRange:1}},title:"Tone",description:""})}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("tvglitch",function(){var a=.2,b=.8,c=.02,d=.3,e=7,f=20;return{initialize:function(e){var g,h,i,j=this.gl,k,l,m;this.lastHeight=this.height,m=[],h=d-c,i=b-a;for(g=0;g<f;g++)m.push(Math.random()*2-1),m.push(Math.random()*i+a),m.push(Math.random()*h+c),m.push(Math.random()*.2);this.particleBuffer=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,this.particleBuffer),j.bufferData(j.ARRAY_BUFFER,new Float32Array(m),j.STATIC_DRAW),this.particleBuffer.itemSize=4,this.particleBuffer.numItems=f,k="#ifdef GL_ES\nprecision mediump float;\n#endif \n\nattribute vec4 particle;\n\nuniform float time;\nuniform float height;\n\nvarying float intensity;\n\nvoid main(void) {\n	float y = particle.x + time * particle.y;\n	y = fract((y + 1.0) / 2.0) * 4.0 - 2.0;\n	intensity = particle.w;\n	gl_Position = vec4(0.0, -y , 1.0, 2.0);\n	gl_PointSize = height * particle.z;\n}\n",l="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying float intensity;\n\nvoid main(void) {\n	gl_FragColor = vec4(1.0);\n	gl_FragColor.a = 2.0 * intensity * (1.0 - abs(gl_PointCoord.y - 0.5));\n}\n",this.particleShader=new Seriously.util.ShaderProgram(j,k,l),this.particleFrameBuffer=new Seriously.util.FrameBuffer(j,1,this.height/2),e()},shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\n#define HardLight(top, bottom)  (1.0 - 2.0 * (1.0 - top) * (1.0 - bottom))\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform sampler2D particles;\nuniform float time;\nuniform float scanlines;\nuniform float lineSync;\nuniform float lineHeight;\nuniform float distortion;\nuniform float vsync;\nuniform float bars;\n\n"+Seriously.util.shader.noiseHelpers+Seriously.util.shader.snoise2d+"\n"+"void main(void) {\n"+"	vec2 texCoord = vTexCoord;\n"+"	float drandom = snoise(vec2(time * 50.0, texCoord.y /lineHeight));\n"+"	float distortAmount = distortion * (drandom - 0.25) * 0.5;\n"+"	vec4 particleOffset = texture2D(particles, vec2(0.0, texCoord.y));\n"+"	distortAmount -= lineSync * (2.0 * particleOffset.a - 0.5);\n"+"	texCoord.x -= distortAmount;\n"+"	texCoord.x = mod(texCoord.x, 1.0);\n"+"	float roll;\n"+"	if (vsync != 0.0) {\n"+"		roll = fract(time / vsync);\n"+"		texCoord.y = mod(texCoord.y - roll, 1.0);\n"+"	}\n"+"	vec4 pixel = texture2D(source, texCoord);\n"+"	float barsAmount = particleOffset.r;\n"+"	if (barsAmount > 0.0) {\n"+"		pixel = vec4(pixel.r + bars * barsAmount,"+"pixel.g + bars * barsAmount,"+"pixel.b + bars * barsAmount,"+"pixel.a);\n"+"	}\n"+"	if (mod(texCoord.y / lineHeight, 2.0) < 1.0 ) {\n"+"		pixel.rgb *= (1.0 - scanlines);\n"+"	}\n"+"	gl_FragColor = pixel; //vec4(vec3(particleOffset), 1.0);\n"+"}\n",b},draw:function(a,b,c,d,e){var g=this.lastTime!==this.inputs.time,h,i,j,k,l=this.gl;this.lastHeight!==this.height&&(this.lastHeight=this.height,g=!0),c.lineHeight=1/this.height,this.inputs.verticalSync?(h=.2/this.inputs.verticalSync,c.vsync=h):(h=1,c.vsync=0),c.time=this.inputs.time%(1e4*h)/1e3,c.distortion=Math.random()*this.inputs.distortion,g&&(this.inputs.lineSync||this.inputs.bars)&&(k=this.inputs.time-this.lastTime,this.particleShader.useProgram(),l.viewport(0,0,1,this.height/2),l.bindFramebuffer(l.FRAMEBUFFER,this.particleFrameBuffer.frameBuffer),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),l.enableVertexAttribArray(this.particleShader.location_particle),l.bindBuffer(l.ARRAY_BUFFER,this.particleBuffer),l.vertexAttribPointer(this.particleShader.location_particle,this.particleBuffer.itemSize,l.FLOAT,!1,0,0),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE),this.particleShader.set_time(c.time),this.particleShader.set_height(this.height),l.drawArrays(l.POINTS,0,f),this.lastTime=this.inputs.time),c.particles=this.particleFrameBuffer.texture,e(a,b,c,d)},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",defaultValue:0},distortion:{type:"number",defaultValue:.1,min:0,max:1},verticalSync:{type:"number",defaultValue:.1,min:0,max:1},lineSync:{type:"number",uniform:"lineSync",defaultValue:.2,min:0,max:1},scanlines:{type:"number",uniform:"scanlines",defaultValue:.3,min:0,max:1},bars:{type:"number",uniform:"bars",defaultValue:0,min:0,max:1}},description:"",title:"TV Glitch"}}())}(window),function(a,b){"use strict",a.Seriously=a.Seriously||{plugin:function(a,b){this[a]=b}},Seriously.plugin("vignette",{shader:function(a,b,c){return b.fragment="#ifdef GL_ES\n\nprecision mediump float;\n\n#endif\n\n\nvarying vec2 vTexCoord;\nvarying vec4 vPosition;\n\nuniform sampler2D source;\nuniform float amount;\n\nvoid main(void) {\n	vec4 pixel = texture2D(source, vTexCoord);\n	vec2 pos = vTexCoord.xy - 0.5;\n	float vignette = 1.0 - (dot(pos, pos) * amount);\n	gl_FragColor = vec4(pixel.rgb * vignette, pixel.a);\n}\n",b},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:1,min:0}},title:"Vignette",description:"Vignette"})}(window);